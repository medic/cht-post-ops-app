<?xml version="1.0"?>
<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:h="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:orx="http://openrosa.org/xforms">
  <h:head>
    <h:title>Confirm Clinic Visit Following SMS Referral</h:title>
    <model>
      <instance>
        <r id="referral_confirmation" prefix="J1!referral_confirmation!" delimiter="#" version="2017-09-30 00:00:00">
          <inputs>
            <meta>
              <location>
                <lat/>
                <long/>
                <error/>
                <message/>
              </location>
            </meta>
            <source>user</source>
            <source_id/>
            <contact>
              <_id/>
              <name/>
              <phone/>
              <reported_date/>
            </contact>
          </inputs>
          <patient_name/>
          <phone/>
          <patient_id tag="hidden"/>
          <c_reported_date tag="hidden"/>
          <first_visit/>
          <note/>
          <return/>
          <visit_date/>
          <trace/>
          <explanation/>
          <comments/>
          <meta tag="hidden">
            <instanceID/>
          </meta>
        </r>
      </instance>
      <instance id="contact-summary"/>
      <bind nodeset="/r/inputs" relevant="./source = 'user'"/>
      <bind nodeset="/r/inputs/source" type="string"/>
      <bind nodeset="/r/inputs/source_id" type="string"/>
      <bind nodeset="/r/inputs/contact/_id" type="db:person" required="true()"/>
      <bind nodeset="/r/inputs/contact/name" type="string"/>
      <bind nodeset="/r/inputs/contact/phone" type="string"/>
      <bind nodeset="/r/inputs/contact/reported_date" type="string"/>
      <bind nodeset="/r/patient_name" type="string" calculate="../inputs/contact/name"/>
      <bind nodeset="/r/phone" type="string" calculate="../inputs/contact/phone"/>
      <bind nodeset="/r/patient_id" type="string" required="true()" calculate="../inputs/contact/_id"/>
      <bind nodeset="/r/c_reported_date" type="string" calculate="../inputs/contact/reported_date"/>
      <bind nodeset="/r/first_visit" type="string" calculate="today()"/>
      <bind nodeset="/r/note" readonly="true()" type="string"/>
      <bind nodeset="/r/return" type="select1" required="true()"/>
      <bind nodeset="/r/visit_date" type="date" required="true()" relevant="selected( /r/return , 'yes')" jr:constraintMsg="Please select current or previous date" constraint=". &lt;= today()"/>
      <bind nodeset="/r/trace" type="select1" required="true()" relevant="selected( /r/return , 'no')"/>
      <bind nodeset="/r/explanation" type="string" required="true()" relevant="selected( /r/trace , 'no')"/>
      <bind nodeset="/r/comments" type="string" relevant="selected( /r/trace , 'yes')"/>
      <bind nodeset="/r/meta/instanceID" type="string" readonly="true()" calculate="concat('uuid:', uuid())"/>
    </model>
  </h:head>
  <h:body class="pages">
    <group appearance="field-list" ref="/r/inputs">
      <label>Patient</label>
      <input appearance="hidden" ref="/r/inputs/source">
        <label>Source</label>
      </input>
      <input appearance="hidden" ref="/r/inputs/source_id">
        <label>Source ID</label>
      </input>
      <group ref="/r/inputs/contact">
        <label>Contact</label>
        <input appearance="db-object" ref="/r/inputs/contact/_id">
          <label>What is the patient's name?</label>
          <hint>Select a person from list</hint>
        </input>
      </group>
    </group>
    <input ref="/r/note">
      <label>When 2WT client has been asked to return to the clinic for an in-person visit, the Study Nurse will use this form to document whether the client returned. This information should be copied from the paper VMMC Register or the paper VMMC Client Intake Form.</label>
    </input>
    <select1 ref="/r/return">
      <label>Did the client return to the clinic?</label>
      <item>
        <label>Yes</label>
        <value>yes</value>
      </item>
      <item>
        <label>No</label>
        <value>no</value>
      </item>
    </select1>
    <input ref="/r/visit_date">
      <label>Date of in-person visit</label>
    </input>
    <select1 ref="/r/trace">
      <label>Was the client referred for patient tracing?</label>
      <item>
        <label>Yes</label>
        <value>yes</value>
      </item>
      <item>
        <label>No</label>
        <value>no</value>
      </item>
    </select1>
    <input ref="/r/explanation">
      <label>Please explain why the patient was not traced.</label>
    </input>
    <input ref="/r/comments">
      <label>Comments</label>
    </input>
  </h:body>
</h:html>
