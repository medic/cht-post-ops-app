<?xml version="1.0"?>
<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:h="http://www.w3.org/1999/xhtml" xmlns:jr="http://openrosa.org/javarosa" xmlns:orx="http://openrosa.org/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <h:head>
    <h:title>Confirm Clinic Visit Following SMS Referral</h:title>
    <model>
      <instance>
        <r delimiter="#" id="referral_confirmation" prefix="J1!referral_confirmation!" version="2017-09-30 00:00:00">
          <inputs>
            <meta>
              <location>
                <lat/>
                <long/>
                <error/>
                <message/>
              </location>
            </meta>
            <source>user</source>
            <source_id/>
            <contact>
              <_id/>
              <name/>
              <phone/>
              <reported_date/>
            </contact>
          </inputs>
          <patient_name/>
          <phone/>
          <patient_id/>
          <c_reported_date/>
          <first_visit/>
          <n/>
          <return/>
          <visit_date/>
          <trace/>
          <explanation/>
          <comments/>
          <meta tag="hidden">
            <instanceID/>
          </meta>
        </r>
      </instance>
      <instance id="contact-summary"/>
      <bind nodeset="/r/inputs" relevant="./source = 'user'"/>
      <bind nodeset="/r/inputs/source" type="string"/>
      <bind nodeset="/r/inputs/source_id" type="string"/>
      <bind nodeset="/r/inputs/contact/_id" type="db:person"/>
      <bind nodeset="/r/inputs/contact/name" type="string"/>
      <bind nodeset="/r/inputs/contact/phone" type="string"/>
      <bind nodeset="/r/inputs/contact/reported_date" type="string"/>
      <bind calculate="../inputs/contact/name" nodeset="/r/patient_name" type="string"/>
      <bind calculate="../inputs/contact/phone" nodeset="/r/phone" type="string"/>
      <bind calculate="../inputs/contact/_id" nodeset="/r/patient_id" required="true()" type="string"/>
      <bind calculate="../inputs/contact/reported_date" nodeset="/r/c_reported_date" type="string"/>
      <bind calculate="today()" nodeset="/r/first_visit" type="string"/>
      <bind nodeset="/r/n" readonly="true()" type="string"/>
      <bind nodeset="/r/return" required="true()" type="select1"/>
      <bind constraint=". &lt;= today()" nodeset="/r/visit_date" relevant=" /r/return  = 'yes'" required="true()" type="date"/>
      <bind nodeset="/r/trace" relevant=" /r/return  = 'no'" required="true()" type="select1"/>
      <bind nodeset="/r/explanation" relevant=" /r/trace  = 'no'" required="true()" type="string"/>
      <bind nodeset="/r/comments" type="string"/>
      <bind calculate="concat('uuid:', uuid())" nodeset="/r/meta/instanceID" readonly="true()" type="string"/>
    </model>
  </h:head>
  <h:body class="pages">
    <group appearance="field-list" ref="/r/inputs">
      <label>Patient</label>
      <input appearance="hidden" ref="/r/inputs/source">
        <label>Source</label>
      </input>
      <input appearance="hidden" ref="/r/inputs/source_id">
        <label>Source ID</label>
      </input>
      <group ref="/r/inputs/contact">
        <label>Contact</label>
        <input appearance="db-object" ref="/r/inputs/contact/_id">
          <label>What is the patient's name?</label>
          <hint>Select a person from list</hint>
        </input>
        <input ref="/r/inputs/contact/name">
          <label>Patient Name</label>
        </input>
        <input ref="/r/inputs/contact/phone">
          <label>Phone Number</label>
        </input>
        <input appearance="hidden" ref="/r/inputs/contact/reported_date">
          <label>Reported Date</label>
        </input>
      </group>
    </group>
    <input ref="/r/n">
      <label>When 2WT client has been asked to return to the clinic for an in-person visit, the Study Nurse will use this form to document whether the client returned. This information should be copied from the paper VMMC Register or the paper VMMC Client Intake Form.</label>
    </input>
    <select1 ref="/r/return">
      <label>Did the client return to the clinic?</label>
      <item>
        <label>Yes</label>
        <value>yes</value>
      </item>
      <item>
        <label>No</label>
        <value>no</value>
      </item>
    </select1>
    <input ref="/r/visit_date">
      <label>Date of in-person visit</label>
    </input>
    <select1 ref="/r/trace">
      <label>Was the client referred for patient tracing?</label>
      <item>
        <label>Yes</label>
        <value>yes</value>
      </item>
      <item>
        <label>No</label>
        <value>no</value>
      </item>
    </select1>
    <input ref="/r/explanation">
      <label>Please explain why they have not attended the clinic.</label>
    </input>
    <input ref="/r/comments">
      <label>Comments</label>
    </input>
  </h:body>
</h:html>
